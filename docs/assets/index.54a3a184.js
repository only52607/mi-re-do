import{s as e,_ as t,d as n,m as s,u as a,f as l,e as i,g as o,h as u,i as r,j as d,p as c,k as m,l as p,b as v}from"./index.5e15b890.js";import{_ as g,a as y,b,c as f}from"./MemberList.vue_vue&type=script&setup=true&lang.dd2b1256.js";import{d as k,a as h,o as _,c as x,w as I,f as w,g as C,u as T,N as S,e as q,b as M,F as $,l as B,t as N,V as j,W as U,X as F,r as A,Y as D,Z as E,_ as L,i as J,$ as P,x as X,a0 as O,a1 as G,v as H,s as K,a2 as R,p as V,a3 as Y}from"./vendor.33ec9ea5.js";j("data-v-2c1e1972");const z={id:"session-name"};U();var Q=k({props:{sessionList:{type:null,required:!0}},setup:n=>(s,a)=>{const l=h("a-empty"),i=h("a-col"),o=h("a-badge"),u=h("a-row"),r=h("a-menu-item"),d=h("a-menu");return _(),x(d,{mode:"inline"},{default:I((()=>[0==n.sessionList.length?(_(),x(l,{key:0})):(_(!0),w($,{key:1},C(n.sessionList,((n,s)=>(_(),x(r,{id:"session-item",key:T(e)(n.identity)},{icon:I((()=>{var e,s,a,l,i,o,u,r,d,c,m,p;return["friend"==n.type?(_(),x(t,{key:0,"user-id":null!=(s=null==(e=n.contact)?void 0:e.id)?s:0,nickname:null!=(l=null==(a=n.contact)?void 0:a.nickname)?l:""},null,8,["user-id","nickname"])):S("",!0),"group"==n.type?(_(),x(g,{key:1,"group-id":null!=(o=null==(i=n.contact)?void 0:i.id)?o:0,"group-name":null!=(r=null==(u=n.contact)?void 0:u.name)?r:""},null,8,["group-id","group-name"])):S("",!0),"temp"==n.type?(_(),x(t,{key:2,"user-id":null!=(c=null==(d=n.contact)?void 0:d.id)?c:0,nickname:null!=(p=null==(m=n.contact)?void 0:m.memberName)?p:""},null,8,["user-id","nickname"])):S("",!0)]})),default:I((()=>[q(u,null,{default:I((()=>[q(i,{span:20},{default:I((()=>{var e,t,s;return[M("span",z,["friend"==n.type?(_(),w($,{key:0},[B(N(null==(e=n.contact)?void 0:e.nickname),1)],64)):S("",!0),"group"==n.type?(_(),w($,{key:1},[B(N(null==(t=n.contact)?void 0:t.name),1)],64)):S("",!0),"temp"==n.type?(_(),w($,{key:2},[B(N(null==(s=n.contact)?void 0:s.memberName),1)],64)):S("",!0)])]})),_:2},1024),q(i,{span:4},{default:I((()=>[q(o,{"overflow-count":999,count:n.unreadCount},null,8,["count"])])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128))])),_:1})}});Q.__scopeId="data-v-2c1e1972",j("data-v-13ca19f2");const W={key:1},Z=["src"],ee=B("闪图"),te=["src"],ne=B("@全体成员"),se=B(" 语音: "),ae=["href"],le=M("br",null,null,-1),ie=["src"],oe=B("XML"),ue=M("br",null,null,-1),re=B("音乐分享"),de=M("br",null,null,-1),ce=B("App"),me=M("br",null,null,-1),pe=B("Json"),ve=M("br",null,null,-1),ge=B("文件");U();var ye=k({props:{message:{type:null,required:!0}},emits:["display-image"],setup(e){function t(e){var t;return("Image"==e.type||"FlashImage"==e.type)&&null!=(t=e.url)?t:""}return(n,s)=>{var a,l,i;const o=h("a-tag");return"Source"==e.message.type?(_(),w($,{key:0},[],64)):"Plain"==e.message.type?(_(),w("span",W,N(e.message.text),1)):"Face"==e.message.type?(_(),w($,{key:2},[B(N(`[${e.message.name}]`),1)],64)):"Image"==e.message.type?(_(),w("img",{key:3,onClick:s[0]||(s[0]=s=>n.$emit("display-image",t(e.message))),src:null!=(a=e.message.url)?a:void 0},null,8,Z)):"FlashImage"==e.message.type?(_(),w($,{key:4},[q(o,null,{default:I((()=>[ee])),_:1}),M("img",{onClick:s[1]||(s[1]=s=>n.$emit("display-image",t(e.message))),src:null!=(l=e.message.url)?l:void 0},null,8,te)],64)):"AtAll"==e.message.type?(_(),x(o,{key:5},{default:I((()=>[ne])),_:1})):"At"==e.message.type?(_(),x(o,{key:6},{default:I((()=>[B("@"+N(e.message.display)+"["+N(e.message.target)+"]",1)])),_:1})):"Voice"==e.message.type?(_(),w($,{key:7},[q(o,null,{default:I((()=>{var t;return[se,M("a",{href:null!=(t=e.message.url)?t:void 0},N(e.message.voiceId),9,ae)]})),_:1}),le,M("audio",{src:null!=(i=e.message.url)?i:void 0,controls:"true"},"Your browser does not support the audio element.",8,ie)],64)):"Poke"==e.message.type?(_(),x(o,{key:8},{default:I((()=>[B("Poke "+N(e.message.name),1)])),_:1})):"Xml"==e.message.type?(_(),w($,{key:9},[q(o,null,{default:I((()=>[oe])),_:1}),ue,B(" "+N(e.message.xml),1)],64)):"MusicShare"==e.message.type?(_(),w($,{key:10},[q(o,null,{default:I((()=>[re])),_:1}),de,B(" "+N(e.message.musicUrl),1)],64)):"App"==e.message.type?(_(),w($,{key:11},[q(o,null,{default:I((()=>[ce])),_:1}),me,B(" "+N(e.message.content),1)],64)):"Json"==e.message.type?(_(),w($,{key:12},[q(o,null,{default:I((()=>[pe])),_:1}),ve,B(" "+N(e.message.json),1)],64)):"Quote"==e.message.type?(_(),x(o,{key:13},{default:I((()=>[B("引用 "+N(e.message.id),1)])),_:1})):"File"==e.message.type?(_(),w($,{key:14},[q(o,{class:"tag"},{default:I((()=>[ge])),_:1}),B(" "+N(e.message.id),1)],64)):"Forward"==e.message.type?(_(),x(o,{key:15},{default:I((()=>[B("转发消息 "+N(e.message.title),1)])),_:1})):S("",!0)}}});ye.__scopeId="data-v-13ca19f2",j("data-v-2ad733fc");const be=B("显示 MessageChain"),fe=B("不支持的消息");U();var ke=k({props:{content:{type:null,required:!0},isSend:{type:Boolean,required:!1}},emits:["display-image"],setup(e,{emit:t}){const n=e;function s(e){t("display-image",e)}const a=F((()=>{if(1==n.content.length)return"Image"==n.content[0].type;if(2!=n.content.length)return!1;return"Image"==n.content[1].type})),l=F((()=>1==n.content.length&&"Source"==n.content[0].type)),i=A(!1);function o(){i.value=!1,E.confirm({content:JSON.stringify(n.content)})}return(t,n)=>{const u=h("a-menu-item"),r=h("a-menu"),d=h("a-tag"),c=h("a-popover");return _(),x(c,{visible:i.value,"onUpdate:visible":n[0]||(n[0]=e=>i.value=e),trigger:"contextmenu"},{content:I((()=>[q(r,{selectable:!1},{default:I((()=>[q(u,{onClick:o},{default:I((()=>[be])),_:1})])),_:1})])),default:I((()=>[M("div",{class:D({receive:!e.isSend,send:e.isSend,multi:!T(a)})},[T(l)?(_(),x(d,{key:0},{default:I((()=>[fe])),_:1})):S("",!0),(_(!0),w($,null,C(e.content,(e=>(_(),x(ye,{onDisplayImage:s,message:e},null,8,["message"])))),256))],2)])),_:1},8,["visible"])}}});ke.__scopeId="data-v-2ad733fc",j("data-v-7d66884a");const he={key:0,id:"item",style:{"flex-direction":"row-reverse"}},_e={id:"bubble-and-name",style:{"text-align":"right"}},xe={style:{"margin-right":"15px"}},Ie={key:1,id:"item"},we={id:"bubble-and-name"},Ce={style:{"margin-left":"15px"}},Te={id:"bubble-and-name"},Se={style:{"margin-left":"15px"}},qe={id:"bubble-and-name"},Me={style:{"margin-left":"15px"}};U();var $e=k({props:{event:{type:null,required:!0}},emits:["display-image","bubble-context-menu"],setup(e,{emit:n}){function s(e){n("display-image",e)}return(n,a)=>"SentMessage"==e.event.type?(_(),w("div",he,[q(t,{id:"avatar","user-id":e.event.botId,nickname:e.event.bot.nickname},null,8,["user-id","nickname"]),M("div",_e,[M("div",xe,N(e.event.bot.nickname),1),q(ke,{onDisplayImage:s,content:e.event.messageChain,"is-send":!0},null,8,["content"])])])):(_(),w("div",Ie,["FriendMessage"==e.event.type?(_(),w($,{key:0},[q(t,{id:"avatar","user-id":e.event.sender.id,nickname:e.event.sender.nickname},null,8,["user-id","nickname"]),M("div",we,[M("div",Ce,N(e.event.sender.nickname),1),q(ke,{onDisplayImage:s,content:e.event.messageChain},null,8,["content"])])],64)):S("",!0),"GroupMessage"==e.event.type?(_(),w($,{key:1},[q(t,{id:"avatar","user-id":e.event.sender.id,nickname:e.event.sender.memberName},null,8,["user-id","nickname"]),M("div",Te,[M("div",Se,[q(y,{member:e.event.sender},null,8,["member"]),B(" "+N(e.event.sender.memberName),1)]),q(ke,{onDisplayImage:s,content:e.event.messageChain},null,8,["content"])])],64)):S("",!0),"TempMessage"==e.event.type?(_(),w($,{key:2},[q(t,{id:"avatar","user-id":e.event.sender.id,nickname:e.event.sender.memberName},null,8,["user-id","nickname"]),M("div",qe,[M("div",Me,N(e.event.sender.memberName),1),q(ke,{onDisplayImage:s,content:e.event.messageChain},null,8,["content"])])],64)):S("",!0)]))}});$e.__scopeId="data-v-7d66884a",j("data-v-58a0caea");const Be={id:"chat-list"};U();var Ne=k({props:{session:{type:null,required:!0},scrollToButtom:{type:Boolean,required:!0}},emits:["update:scroll-to-buttom"],setup(e,{emit:t}){const s=e,a=A(!1),l=A("");function i(){s.scrollToButtom&&function(){const e=document.getElementById("chat-list");e&&(e.scrollTop=e.scrollHeight)}()}function o(e){l.value=e,a.value=!0}return L((()=>{i()})),J((()=>s.session.events.length),(()=>{P((()=>{i()}))})),X((()=>{i();const e=document.getElementById("chat-list");e&&(e.onscroll=()=>{t("update:scroll-to-buttom",Math.abs(e.scrollHeight-e.scrollTop-e.clientHeight)<1)})})),(t,s)=>(_(),w("div",Be,[(_(!0),w($,null,C(e.session.events,(e=>(_(),x($e,{onDisplayImage:o,event:e},null,8,["event"])))),256)),q(n,{visible:a.value,title:"查看图片","image-url":l.value,"onUpdate:visible":s[0]||(s[0]=e=>a.value=e)},null,8,["visible","image-url"])]))}});Ne.__scopeId="data-v-58a0caea";var je=k({props:{session:{type:null,required:!0}},setup:e=>(t,n)=>{const s=h("a-page-header");return _(),x(s,{style:{background:"#fff"},onBack:n[0]||(n[0]=()=>{})},{backIcon:I((()=>[O(t.$slots,"backIcon")])),extra:I((()=>[O(t.$slots,"extra",{session:e.session})])),title:I((()=>[O(t.$slots,"title",{session:e.session})])),subTitle:I((()=>[O(t.$slots,"subTitle",{session:e.session})])),_:3})}});j("data-v-56405bb0");const Ue={key:1,id:"main"},Fe={id:"header"},Ae={id:"content"},De={id:"chat-message-area"},Ee={id:"input-area"},Le={id:"send-area",justify:"end",style:{padding:"5px"}},Je=B(" 发送 "),Pe=B("以MessageChain标准形式发送"),Xe=B("以XML消息发送"),Oe=B("以JSON消息发送");U();var Ge=k({props:{session:{type:null,required:!0},pendingText:{type:String,required:!0},scrollToButtom:{type:Boolean,required:!0}},emits:["send","update:pending-text","update:scroll-to-buttom"],setup(e,{emit:t}){const n=e,a=e=>t("update:pending-text",e),l=e=>t("update:scroll-to-buttom",e);function i(e){const a=function(e,t){switch(e){case"xml":return[s.buildXml(t)];case"json":return[s.buildApp(t)];case"text":return[s.buildPlain(t)];case"message-chain":const e=JSON.parse(t);return e instanceof Array?e:[e]}}(e,n.pendingText);a&&t("send",a)}return(t,n)=>{const s=h("a-empty"),o=h("a-textarea"),u=h("a-menu-item"),r=h("a-menu"),d=h("a-dropdown-button");return e.session?(_(),w("div",Ue,[M("div",Fe,[q(je,{session:e.session},{backIcon:I((()=>[O(t.$slots,"backIcon",{},void 0,!0)])),extra:I((({session:e})=>[O(t.$slots,"headerExtra",{session:e},void 0,!0)])),title:I((({session:e})=>[O(t.$slots,"title",{session:e},void 0,!0)])),subTitle:I((({session:e})=>[O(t.$slots,"subTitle",{session:e},void 0,!0)])),_:3},8,["session"])]),M("div",Ae,[M("div",De,[q(Ne,{"scroll-to-buttom":e.scrollToButtom,"onUpdate:scrollToButtom":l,session:e.session},null,8,["scroll-to-buttom","session"])]),M("div",Ee,[q(o,{value:e.pendingText,placeholder:"发送消息","auto-size":{minRows:2,maxRows:4},"onUpdate:value":a},null,8,["value"])]),M("div",Le,[q(d,{onClick:n[3]||(n[3]=e=>i("text")),type:"primary"},{overlay:I((()=>[q(r,null,{default:I((()=>[q(u,{key:"message-chain",onClick:n[0]||(n[0]=e=>i("message-chain"))},{default:I((()=>[Pe])),_:1}),q(u,{key:"xml",onClick:n[1]||(n[1]=e=>i("xml"))},{default:I((()=>[Xe])),_:1}),q(u,{key:"json",onClick:n[2]||(n[2]=e=>i("json"))},{default:I((()=>[Oe])),_:1})])),_:1})])),icon:I((()=>[q(T(G))])),default:I((()=>[Je])),_:1})]),O(t.$slots,"content",{session:e.session},void 0,!0)])])):(_(),x(s,{key:0,style:{height:"100%"}}))}}});Ge.__scopeId="data-v-56405bb0",j("data-v-9d7568d6");const He={id:"main"},Ke={id:"left"},Re={id:"right"};U();var Ve=k({setup(t){const n=r(),{botProfile:s}=a(),g=v(),y=H(),k=K(),C=A([]),$=A(!1),j=A(""),U=m(),D=A(!0),L=A(!1),P=d();function O(){y.query.sessionIdentityString&&(C.value=[y.query.sessionIdentityString],L.value=!1)}X((()=>O())),J((()=>y.query),(()=>O()));const G=F((()=>{if(0==C.value.length)return;const{session:e}=l(C.value[0]);return e&&(e.unreadCount=0),P.value=null==e?void 0:e.identity,e})),z=e=>{switch(e.type){case"friend":return e.contact.nickname;case"temp":return e.contact.memberName;case"group":return e.contact.name}},W=e=>e.contact.id;async function Z(e){if(null!=U.value&&null!=G.value)try{await async function(e){var t,n;if(null==G.value||null==U.value)return;let a;switch(G.value.type){case"friend":a=await U.value.sendFriendMessage(e,G.value.contact.id);break;case"group":a=await U.value.sendGroupMessage(e,G.value.contact.id);break;case"temp":a=await U.value.sendTempMessage(e,G.value.contact.id,G.value.contact.group.id)}if(!a)throw Error("unknown session type");U.value.emitEvent({type:"SentMessage",receipt:a,bot:s.value,botId:null!=(n=null==(t=g.value)?void 0:t.authentication.qq)?n:0,messageChain:e,targetType:G.value.type,target:G.value.contact})}(e);j.value="",D.value=!0}catch{V.error("消息发送失败")}else V.error("未就绪")}function ee(){E.confirm({title:"确认删除该聊天以及该聊天的所有聊天记录?",icon:q(Y),content:"此操作不可逆!",onOk(){!function(){if(null==G.value)return;const e=n.value.findIndex((e=>p(e.identity,G.value.identity)));e<0||(C.value=[],n.value.splice(e,1),V.success("已删除"))}()}})}const te=A(),{profile:ne}=i(te),se=A(),{members:ae,state:le}=o(se),ie=F((()=>"done"!=le.value)),oe=A();function ue(){if(G.value)if(L.value)L.value=!1;else{switch(G.value.type){case"friend":te.value=G.value.contact.id;break;case"group":se.value=G.value.contact.id;break;case"temp":oe.value=G.value.contact}L.value=!0}}function re(t){c("temp",t),k.push({name:"session",query:{sessionIdentityString:e([t.id,"temp"])}})}return(e,t)=>{const s=h("menu-switch"),a=h("a-menu-item"),l=h("a-menu"),i=h("a-button"),o=h("a-popover"),r=h("a-drawer");return _(),w("div",He,[M("div",Ke,[q(Q,{id:"left-content","session-list":T(n),selectedKeys:C.value,"onUpdate:selectedKeys":t[0]||(t[0]=e=>C.value=e),"inline-collapsed":$.value,onSelect:t[1]||(t[1]=e=>D.value=!0)},null,8,["session-list","selectedKeys","inline-collapsed"])]),M("div",Re,[q(Ge,{onSend:Z,session:T(G),"pending-text":j.value,"onUpdate:pending-text":t[4]||(t[4]=e=>j.value=e),"scroll-to-buttom":D.value,"onUpdate:scroll-to-buttom":t[5]||(t[5]=e=>D.value=e)},{backIcon:I((()=>[q(s,{collapsed:$.value,"onUpdate:collapsed":t[2]||(t[2]=e=>$.value=e)},null,8,["collapsed"])])),headerExtra:I((()=>[q(o,{placement:"bottom",trigger:"click"},{content:I((()=>[q(l,{selectable:!1},{default:I((()=>[q(a,null,{default:I((()=>[M("span",{onClick:ee},"删除此会话")])),_:1})])),_:1})])),default:I((()=>[q(i,{type:"text",class:"more-button"},{icon:I((()=>[q(T(R))])),_:1})])),_:1})])),title:I((({session:e})=>[M("div",{onClick:ue,class:"session-title"},N(z(e)),1)])),subTitle:I((({session:e})=>[B(N(W(e)),1)])),content:I((({session:e})=>[q(r,{placement:"right",closable:!0,visible:L.value,"get-container":!1,"wrap-style":{position:"absolute"},onClose:t[3]||(t[3]=e=>L.value=!1),width:500},{default:I((()=>["friend"==e.type?(_(),x(u,{key:0,"user-id":e.contact.id,profile:T(ne)},null,8,["user-id","profile"])):S("",!0),"group"==e.type?(_(),x(b,{key:1,onGotoTempSession:re,"member-list":T(ae),loading:T(ie),grid:{gutter:10,xs:1,sm:1,md:2,lg:2,xl:3,xxl:1}},null,8,["member-list","loading"])):S("",!0),"temp"==e.type?(_(),x(f,{key:2,member:oe.value},null,8,["member"])):S("",!0)])),_:2},1032,["visible"])])),_:1},8,["session","pending-text","scroll-to-buttom"])])])}}});Ve.__scopeId="data-v-9d7568d6";export{Ve as default};
